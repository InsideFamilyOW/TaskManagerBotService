# Task Manager Bot v2.0

Полнофункциональный бот для управления задачами с ролевой системой, коммуникацией и логированием действий.

## 🎯 Функционал

### 👑 Администратор
- ➕ Добавление/удаление пользователей
- ✏️ Назначение ролей и прав доступа
- 📊 Просмотр полной статистики системы
- ⚙️ Настройка каналов логов по направлениям
- 👥 Управление всеми пользователями
- 📋 Мониторинг всех задач

### 👔 Байер (Buyer)
- ➕ Создание задач с выбором направления и исполнителя
- 👤 Просмотр загрузки исполнителей при выборе
- 📋 Управление своими задачами
- 💬 Коммуникация с исполнителями через бота
- ✅ Проверка и одобрение результатов
- ✏️ Запрос правок по задачам
- ⭐️ Оценка работы исполнителей (1-5 звезд)
- 📊 Просмотр личной статистики

### 🛠️ Исполнитель (Executor)
- 📨 Получение уведомлений о новых задачах в ЛС
- ▶️ Принятие задач в работу
- ❌ Возможность отказа с указанием причины
- 💬 Прямая переписка с байером по задаче
- 📎 Отправка файлов результата
- ✅ Завершение задач с комментариями
- 📊 Просмотр своей загрузки и статистики

## 📦 Структура проекта

```
Task_Manager_Bot/
├── bot/
│   ├── __init__.py
│   ├── bot.py                      # Инициализация бота
│   ├── handlers/
│   │   ├── __init__.py            # Регистрация обработчиков
│   │   ├── common.py              # Общие обработчики (start, help)
│   │   ├── admin.py               # Обработчики администратора
│   │   ├── buyer.py               # Обработчики байера
│   │   └── executor.py            # Обработчики исполнителя
│   ├── keyboards/
│   │   ├── __init__.py
│   │   ├── common_kb.py           # Общие клавиатуры
│   │   ├── admin_kb.py            # Клавиатуры администратора
│   │   ├── buyer_kb.py            # Клавиатуры байера
│   │   └── executor_kb.py         # Клавиатуры исполнителя
│   └── utils/
│       ├── __init__.py
│       ├── notifications.py       # Система уведомлений
│       ├── file_handler.py        # Работа с файлами
│       └── log_channel.py         # Логирование в каналы
├── db/
│   ├── __init__.py
│   ├── engine.py                  # Подключение к БД
│   ├── models.py                  # Модели базы данных
│   ├── queries.py                 # Запросы к БД
│   └── init_db.py                 # Инициализация БД
├── states/
│   ├── __init__.py
│   ├── admin_states.py            # FSM состояния админа
│   ├── buyer_states.py            # FSM состояния байера
│   └── executor_states.py         # FSM состояния исполнителя
├── Data/
│   ├── config.py                  # Конфигурация
│   └── log.log                    # Файл логов
├── uploads/                       # Директория для файлов
├── log.py                         # Настройка логирования
├── main.py                        # Точка входа
├── requirements.txt               # Зависимости
├── Dockerfile                     # Docker образ
└── docker-compose.yml             # Docker Compose

```

## 🚀 Установка и запуск

### Требования
- Python 3.10+
- PostgreSQL 14+

### 1. Клонирование и установка зависимостей

```bash
# Установка зависимостей
pip install -r requirements.txt
```

### 2. Настройка конфигурации

Откройте `Data/config.py` и настройте:

```python
# Telegram ID администраторов
ADMIN_TG_ID = [123456789, 987654321]

# Токен бота от @BotFather
BOT_TOKEN = "your_bot_token_here"

# Строка подключения к БД
DATABASE_URL = "postgresql+asyncpg://user:password@host:port/database"
```

### 3. Запуск бота

```bash
python main.py
```

## 🔧 Настройка каналов логов

1. Создайте каналы в Telegram для каждого направления:
   - 🎨 Дизайн
   - 🏢 Агенство
   - ✍️ Копирайтинг
   - 📱 Маркетинг

2. Добавьте бота в каналы как администратора

3. В боте от имени администратора:
   - Выберите "⚙️ Настройки каналов логов"
   - "➕ Добавить канал"
   - Выберите направление
   - Введите ID канала (например: -1001234567890)

## 📋 Рабочий процесс

### Создание задачи (Байер)

1. **Выбор направления и исполнителя**
   - Байер видит список направлений с количеством доступных исполнителей
   - При выборе направления показываются исполнители с их текущей загрузкой

2. **Заполнение данных задачи**
   - Название (до 200 символов)
   - Подробное описание
   - Приоритет (🟢 Низкий / 🟡 Средний / 🟠 Высокий / 🔴 Срочный)
   - Дедлайн (опционально)
   - Файлы (опционально)

3. **Подтверждение и отправка**
   - Превью задачи перед отправкой
   - Возможность редактирования
   - Задача отправляется исполнителю в ЛС

### Выполнение задачи (Исполнитель)

1. **Получение уведомления**
   ```
   🆕 НОВАЯ ЗАДАЧА ОТ БАЙЕРА
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   📌 TASK-0042: Баннер для соцсетей
   👤 От: Иван Петров
   ⏱️ Срок: до 25.12.2025
   📍 Приоритет: Средний
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   [▶️ ВЗЯТЬ В РАБОТУ] [❌ ОТКАЗАТЬСЯ] [💬 УТОЧНИТЬ]
   ```

2. **Работа над задачей**
   - Взятие в работу (статус: 🟡 В работе)
   - Общение с байером через бота
   - Отправка промежуточных вопросов
   - Добавление файлов

3. **Завершение задачи**
   - Добавление комментария к выполнению
   - Прикрепление файлов результата (до 5 файлов)
   - Отправка байеру на проверку

### Проверка результата (Байер)

1. **Получение уведомления**
   ```
   📬 РЕЗУЛЬТАТ ПО ЗАДАЧЕ TASK-0042
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   🎯 Баннер для соцсетей
   👤 Исполнитель: Алексей
   ⏱️ Время выполнения: 2 дня
   
   [✅ ПРИНЯТЬ] [✏️ ЗАПРОСИТЬ ПРАВКИ] [💬 ОБСУДИТЬ]
   ```

2. **Действия байера**
   - ✅ Принять - одобрить работу с оценкой (1-5 ⭐️)
   - ✏️ Запросить правки - описать что нужно исправить
   - 💬 Обсудить - написать сообщение исполнителю

## 🔍 Логирование действий

Все важные действия логируются в настроенные каналы:

- 🆕 Создание задачи
- 🔄 Изменение статуса
- ✅ Завершение задачи
- 🎉 Одобрение задачи
- ❌ Отказ от задачи

Пример лога:
```
🆕 НОВАЯ ЗАДАЧА
━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 Задача: TASK-0042
📌 Название: Баннер для соцсетей
🎨 Направление: DESIGN
🟡 Приоритет: Средний

👤 От: Иван Петров (Маркетинг)
🛠️ Исполнитель: Алексей Смирнов

⏱️ Срок: до 25.12.2025
📅 Создана: 20.12.2025 15:30
━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 📊 Статистика

### Администратор
- Общее количество пользователей по ролям
- Количество задач по статусам
- Статистика по направлениям
- Загрузка исполнителей

### Байер
- Всего созданных задач
- Задачи в работе
- Завершенные задачи

### Исполнитель
- Всего назначенных задач
- Задачи в работе
- Завершенные задачи
- Текущая загрузка (X/Y задач)

## 🛡️ Безопасность

- Доступ только для зарегистрированных пользователей
- Ролевая система с проверкой прав
- Изоляция данных между пользователями
- Логирование всех действий

## 📝 Версии библиотек

```
aiohttp==3.12.1
aiogram==3.22.0
sqlalchemy==2.0.44
psycopg2-binary==2.9.11
asyncpg==0.31.0
pycryptodome==3.23.0
aiofiles==24.1.0
python-dateutil==2.9.0
```

## 🐳 Docker

```bash
# Сборка и запуск через Docker Compose
docker-compose up -d

# Просмотр логов
docker-compose logs -f

# Остановка
docker-compose down
```

## 📞 Поддержка

При возникновении проблем проверьте:
1. Логи в файле `Data/log.log`
2. Правильность настройки `Data/config.py`
3. Доступ к базе данных
4. Права бота в каналах логов

## 🔄 Обновления

**v2.0** (Текущая версия)
- ✅ Полная ролевая система
- ✅ Коммуникация через бота
- ✅ Каналы логов действий
- ✅ Файловая система
- ✅ Статистика и аналитика
- ✅ Оценка работы
- ✅ Система уведомлений

## 📄 Лицензия

Проект разработан для внутреннего использования.

---

**Task Manager Bot v2.0** - Эффективное управление задачами через Telegram! 🚀

